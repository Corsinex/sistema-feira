<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapeiro - Cozinha</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,sans-serif;background:#f5f5f5;color:#333}
    .header{background:#2c3e50;color:#fff;padding:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .header h1{font-size:24px}
    .tabs{background:#34495e;display:flex;border-bottom:3px solid #3498db}
    .tab{padding:15px 25px;color:#fff;cursor:pointer;border-bottom:3px solid transparent;transition:all 0.3s}
    .tab:hover{background:#2c3e50}
    .tab.active{border-bottom-color:#3498db;background:#2c3e50}
    .container{max-width:1400px;margin:0 auto;padding:20px}
    .section{display:none}
    .section.active{display:block}
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:25px}
    .stat-card{background:#fff;padding:20px;border-radius:8px;text-align:center;border-left:4px solid #3498db;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .stat-label{font-size:14px;color:#7f8c8d;margin-bottom:8px}
    .stat-value{font-size:32px;font-weight:bold;color:#2c3e50}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:15px}
    .pedido-card{background:#fff;border-left:4px solid #3498db;border-radius:8px;padding:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1);transition:all 0.3s}
    .pedido-card:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.15)}
    .pedido-card.urgente{border-left-color:#e74c3c}
    .pedido-numero{font-size:36px;font-weight:bold;color:#3498db;margin-bottom:10px}
    .pedido-info{margin:10px 0;padding:10px;background:#f8f9fa;border-radius:5px}
    .info-row{display:flex;justify-content:space-between;margin:5px 0}
    .info-label{font-size:13px;color:#7f8c8d}
    .info-valor{font-weight:bold;color:#2c3e50}
    .pedido-itens{margin:15px 0;padding:12px;background:#e8f4f8;border-radius:6px;border-left:3px solid #3498db}
    .pedido-item{padding:8px 0;border-bottom:1px solid #ddd}
    .pedido-item:last-child{border-bottom:none}
    .item-nome{font-weight:bold;color:#2c3e50;font-size:15px}
    .item-pers{font-size:13px;color:#7f8c8d;margin-top:3px;font-style:italic}
    .tempo-preparo{background:#f39c12;color:#fff;padding:8px 15px;border-radius:20px;font-weight:bold;display:inline-block;margin:10px 0}
    .tempo-preparo.rapido{background:#27ae60}
    .tempo-preparo.demorado{background:#e74c3c}
    .btn{padding:12px 20px;border:none;border-radius:5px;font-weight:bold;cursor:pointer;font-size:14px;transition:all 0.2s;width:100%;margin-top:10px}
    .btn-success{background:#27ae60;color:#fff}
    .btn-success:hover{background:#229954}
    .btn-primary{background:#3498db;color:#fff}
    .btn-primary:hover{background:#2980b9}
    .btn-danger{background:#e74c3c;color:#fff}
    .btn-danger:hover{background:#c0392b}
    .badge{display:inline-block;padding:5px 12px;border-radius:15px;font-size:12px;font-weight:bold}
    .badge-aguardando{background:#f39c12;color:#fff}
    .badge-preparando{background:#3498db;color:#fff}
    .badge-pronto{background:#27ae60;color:#fff}
    .empty-state{text-align:center;padding:60px 20px;color:#7f8c8d}
    .empty-state-icon{font-size:64px;margin-bottom:20px;opacity:0.3}
    .empty-state-text{font-size:18px}
    .audio-toggle{background:#34495e;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:14px}
    .audio-toggle.active{background:#27ae60}
    .card{background:#fff;border-radius:8px;padding:20px;margin-bottom:20px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .card-title{font-size:20px;font-weight:bold;color:#2c3e50;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #3498db}
  </style>
</head>
<body>
  <div class="header">
    <div>
      <h1>üë®‚Äçüç≥ Chapeiro - Cozinha</h1>
      <p style="font-size:14px;opacity:0.9;margin-top:5px">Prepara√ß√£o de Pedidos</p>
    </div>
    <div>
      <button class="audio-toggle" id="audio-toggle" onclick="toggleAudio()">üîá Som OFF</button>
      <span style="margin:0 15px;font-size:18px" id="relogio"></span>
      <button class="btn btn-primary" style="width:auto;margin:0;padding:10px 20px" onclick="location.reload()">üîÑ Atualizar</button>
    </div>
  </div>
  
  <div class="tabs">
    <div class="tab active" onclick="abrirAba('novos')">üÜï Novos Pedidos (<span id="count-novos">0</span>)</div>
    <div class="tab" onclick="abrirAba('preparando')">üî• Em Preparo (<span id="count-preparando">0</span>)</div>
    <div class="tab" onclick="abrirAba('prontos')">‚úÖ Prontos (<span id="count-prontos">0</span>)</div>
    <div class="tab" onclick="abrirAba('historico')">üìú Hist√≥rico</div>
  </div>
  
  <div class="container">
    <!-- ESTAT√çSTICAS -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-label">Aguardando Preparo</div>
        <div class="stat-value" id="stat-aguardando">0</div>
      </div>
      <div class="stat-card" style="border-left-color:#3498db">
        <div class="stat-label">Em Preparo</div>
        <div class="stat-value" style="color:#3498db" id="stat-preparando">0</div>
      </div>
      <div class="stat-card" style="border-left-color:#27ae60">
        <div class="stat-label">Prontos Hoje</div>
        <div class="stat-value" style="color:#27ae60" id="stat-prontos">0</div>
      </div>
      <div class="stat-card" style="border-left-color:#f39c12">
        <div class="stat-label">Total Hoje</div>
        <div class="stat-value" style="color:#f39c12" id="stat-total">0</div>
      </div>
    </div>
    
    <!-- ABA NOVOS PEDIDOS -->
    <div id="section-novos" class="section active">
      <div class="card">
        <div class="card-title">üÜï Novos Pedidos (Ordem de Chegada)</div>
        <div class="grid" id="lista-novos"></div>
      </div>
    </div>
    
    <!-- ABA EM PREPARO -->
    <div id="section-preparando" class="section">
      <div class="card">
        <div class="card-title">üî• Pedidos em Preparo</div>
        <div class="grid" id="lista-preparando"></div>
      </div>
    </div>
    
    <!-- ABA PRONTOS -->
    <div id="section-prontos" class="section">
      <div class="card">
        <div class="card-title">‚úÖ Pedidos Prontos</div>
        <div class="grid" id="lista-prontos"></div>
      </div>
    </div>
    
    <!-- ABA HIST√ìRICO -->
    <div id="section-historico" class="section">
      <div class="card">
        <div class="card-title">üìú Hist√≥rico do Dia</div>
        <div id="lista-historico"></div>
      </div>
    </div>
  </div>

  <audio id="notification-sound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGi77OmfTRALUKXi8LdjHQU4k9bx0HoqBSl+zPLaizsKHGzA7OucTxELU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RiHQU4k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OqeTBEKUaXi77RjHQU5k9Xx0HorBSh+zPLaizwKG2vA7OucTxEKU6rj7rdiFgU7ldny1YctBSt9zPLeizYIGWm67OucThEKUqfi77NiGAU6kdXx0Hm" type="audio/wav">
  </audio>

  <script>
    firebase.initializeApp({
      apiKey:"AIzaSyAdAQ0PZ3OlOO4i-t7gTi1LqZFnDJXn-eg",
      authDomain:"sistema-padaria-a1ee0.firebaseapp.com",
      databaseURL:"https://sistema-padaria-a1ee0-default-rtdb.firebaseio.com",
      projectId:"sistema-padaria-a1ee0",
      storageBucket:"sistema-padaria-a1ee0.firebasestorage.app",
      messagingSenderId:"1011463014195",
      appId:"1:1011463014195:web:79f941437e29f57a8aa046"
    });
    
    const db=firebase.database();
    let audioEnabled=false;
    let ultimosNovos=0;
    
    // Rel√≥gio
    setInterval(()=>{
      document.getElementById('relogio').textContent=new Date().toLocaleTimeString('pt-BR');
    },1000);
    
    // Toggle √°udio
    function toggleAudio(){
      audioEnabled=!audioEnabled;
      const btn=document.getElementById('audio-toggle');
      if(audioEnabled){
        btn.textContent='üîä Som ON';
        btn.classList.add('active');
      }else{
        btn.textContent='üîá Som OFF';
        btn.classList.remove('active');
      }
    }
    
    // Tocar som
    function tocarSom(){
      if(audioEnabled){
        const audio=document.getElementById('notification-sound');
        audio.play().catch(e=>console.log('Erro ao tocar som:',e));
      }
    }
    
    // Carregar pedidos
    function carregarPedidos(){
      db.ref('pedidos').on('value',snapshot=>{
        const pedidos=[];
        snapshot.forEach(child=>{
          pedidos.push({...child.val(),key:child.key});
        });
        
        // Filtrar por status
        const hoje=new Date().toDateString();
        const novos=pedidos.filter(p=>p.status==='pago').sort((a,b)=>new Date(a.dataHora)-new Date(b.dataHora));
        const preparando=pedidos.filter(p=>p.status==='em_preparo');
        const prontos=pedidos.filter(p=>p.status==='pronto');
        const todosHoje=pedidos.filter(p=>new Date(p.dataHora).toDateString()===hoje);
        
        // Notificar novos pedidos
        if(novos.length>ultimosNovos&&ultimosNovos>0){
          tocarSom();
          if(Notification.permission==='granted'){
            new Notification('Novo Pedido!',{
              body:`Pedido #${novos[novos.length-1].numero} - ${novos[novos.length-1].cliente}`,
              icon:'üîî'
            });
          }
        }
        ultimosNovos=novos.length;
        
        // Atualizar contadores
        document.getElementById('count-novos').textContent=novos.length;
        document.getElementById('count-preparando').textContent=preparando.length;
        document.getElementById('count-prontos').textContent=prontos.length;
        
        document.getElementById('stat-aguardando').textContent=novos.length;
        document.getElementById('stat-preparando').textContent=preparando.length;
        document.getElementById('stat-prontos').textContent=prontos.filter(p=>new Date(p.dataHora).toDateString()===hoje).length;
        document.getElementById('stat-total').textContent=todosHoje.length;
        
        // Renderizar listas
        renderizarPedidos('novos',novos);
        renderizarPedidos('preparando',preparando);
        renderizarPedidos('prontos',prontos);
        renderizarHistorico(todosHoje);
      });
    }
    
    function renderizarPedidos(tipo,pedidos){
      const container=document.getElementById('lista-'+tipo);
      
      if(pedidos.length===0){
        container.innerHTML=`
          <div class="empty-state">
            <div class="empty-state-icon">${tipo==='novos'?'üì•':tipo==='preparando'?'üî•':'‚úÖ'}</div>
            <div class="empty-state-text">Nenhum pedido ${tipo==='novos'?'novo':tipo==='preparando'?'em preparo':'pronto'}</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML=pedidos.map(p=>{
        const tempoDecorrido=Math.floor((Date.now()-new Date(p.dataHora).getTime())/60000);
        const tempoClasse=tempoDecorrido<5?'rapido':tempoDecorrido<10?'':'demorado';
        const urgente=tempoDecorrido>10;
        
        return `
          <div class="pedido-card ${urgente?'urgente':''}">
            <div class="pedido-numero">#${p.numero}</div>
            
            <div class="pedido-info">
              <div class="info-row">
                <span class="info-label">Cliente:</span>
                <span class="info-valor">${p.cliente}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Telefone:</span>
                <span class="info-valor">${p.telefone}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Hor√°rio:</span>
                <span class="info-valor">${new Date(p.dataHora).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}</span>
              </div>
            </div>
            
            <div class="tempo-preparo ${tempoClasse}">
              ‚è±Ô∏è ${tempoDecorrido} min ${urgente?'- URGENTE!':''}
            </div>
            
            <div class="pedido-itens">
              ${p.itens.map(i=>`
                <div class="pedido-item">
                  <div class="item-nome">${i.emoji} ${i.nome}</div>
                  ${i.personalizacao&&i.personalizacao!=='Padr√£o'?`<div class="item-pers">${i.personalizacao}</div>`:''}
                </div>
              `).join('')}
            </div>
            
            ${tipo==='novos'?`
              <button class="btn btn-primary" onclick="iniciarPreparo('${p.key}')">üî• Iniciar Preparo</button>
            `:tipo==='preparando'?`
              <button class="btn btn-success" onclick="marcarPronto('${p.key}')">‚úÖ Marcar como Pronto</button>
            `:tipo==='prontos'?`
              <button class="btn btn-danger" onclick="finalizarPedido('${p.key}')">üì¶ Pedido Entregue</button>
            `:''}
          </div>
        `;
      }).join('');
    }
    
    function renderizarHistorico(pedidos){
      const container=document.getElementById('lista-historico');
      
      if(pedidos.length===0){
        container.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìú</div><div class="empty-state-text">Nenhum pedido hoje</div></div>';
        return;
      }
      
      pedidos.sort((a,b)=>new Date(b.dataHora)-new Date(a.dataHora));
      
      container.innerHTML=pedidos.map(p=>`
        <div class="pedido-card" style="margin-bottom:10px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div class="pedido-numero" style="font-size:24px">#${p.numero}</div>
            <span class="badge badge-${p.status.replace('_','-')}">${p.status.replace('_',' ').toUpperCase()}</span>
          </div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;font-size:14px">
            <div><strong>Cliente:</strong> ${p.cliente}</div>
            <div><strong>Hor√°rio:</strong> ${new Date(p.dataHora).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}</div>
            <div><strong>Total:</strong> R$ ${p.total.toFixed(2).replace('.',',')}</div>
          </div>
        </div>
      `).join('');
    }
    
    function iniciarPreparo(key){
      if(!confirm('Iniciar preparo deste pedido?'))return;
      db.ref('pedidos/'+key+'/status').set('em_preparo').then(()=>{
        console.log('Preparo iniciado');
      });
    }
    
    function marcarPronto(key){
      if(!confirm('Marcar pedido como pronto?'))return;
      db.ref('pedidos/'+key+'/status').set('pronto').then(()=>{
        console.log('Pedido pronto');
      });
    }
    
    function finalizarPedido(key){
      if(!confirm('Confirmar que pedido foi entregue?'))return;
      db.ref('pedidos/'+key+'/status').set('finalizado').then(()=>{
        console.log('Pedido finalizado');
      });
    }
    
    function abrirAba(aba){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('section-'+aba).classList.add('active');
    }
    
    // Pedir permiss√£o para notifica√ß√µes
    if('Notification' in window&&Notification.permission==='default'){
      Notification.requestPermission();
    }
    
    window.onload=()=>{
      carregarPedidos();
    };
  </script>
</body>
</html>
