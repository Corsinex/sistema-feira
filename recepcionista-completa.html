<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recepcionista - Sistema Completo</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,sans-serif;background:#f5f5f5;color:#333}
    .header{background:#2c3e50;color:#fff;padding:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .header h1{font-size:24px}
    .tabs{background:#34495e;display:flex;border-bottom:3px solid #3498db}
    .tab{padding:15px 25px;color:#fff;cursor:pointer;border-bottom:3px solid transparent;transition:all 0.3s}
    .tab:hover{background:#2c3e50}
    .tab.active{border-bottom-color:#3498db;background:#2c3e50}
    .container{max-width:1400px;margin:0 auto;padding:20px}
    .section{display:none}
    .section.active{display:block}
    .btn{padding:12px 24px;border:none;border-radius:5px;font-weight:bold;cursor:pointer;font-size:15px;transition:all 0.2s}
    .btn-primary{background:#3498db;color:#fff}
    .btn-primary:hover{background:#2980b9}
    .btn-success{background:#27ae60;color:#fff}
    .btn-success:hover{background:#229954}
    .btn-danger{background:#e74c3c;color:#fff}
    .btn-danger:hover{background:#c0392b}
    .btn-warning{background:#f39c12;color:#fff}
    .btn-warning:hover{background:#d68910}
    .card{background:#fff;border-radius:8px;padding:20px;margin-bottom:20px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .card-title{font-size:20px;font-weight:bold;color:#2c3e50;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #3498db}
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:25px}
    .stat-card{background:#fff;padding:20px;border-radius:8px;text-align:center;border-left:4px solid #3498db;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .stat-label{font-size:14px;color:#7f8c8d;margin-bottom:8px}
    .stat-value{font-size:32px;font-weight:bold;color:#2c3e50}
    .pedido-card{background:#fff;border-left:4px solid #3498db;border-radius:8px;padding:15px;margin-bottom:12px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    .pedido-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .pedido-numero{font-size:24px;font-weight:bold;color:#3498db}
    .pedido-status{padding:5px 12px;border-radius:15px;font-size:12px;font-weight:bold}
    .status-aguardando{background:#f39c12;color:#fff}
    .status-pago{background:#27ae60;color:#fff}
    .status-pronto{background:#3498db;color:#fff}
    .pedido-info{margin:10px 0}
    .pedido-cliente{font-size:16px;font-weight:bold;color:#2c3e50}
    .pedido-itens{margin:10px 0;padding:10px;background:#f8f9fa;border-radius:5px}
    .pedido-actions{display:flex;gap:8px;margin-top:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px}
    .produto-card{background:#fff;border:2px solid #ddd;border-radius:8px;padding:15px;cursor:pointer;transition:all 0.2s}
    .produto-card:hover{border-color:#3498db;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.1)}
    .produto-card.esgotado{opacity:0.5;cursor:not-allowed;border-color:#e74c3c}
    .produto-header{display:flex;justify-content:space-between;margin-bottom:8px}
    .produto-nome{font-weight:bold;color:#2c3e50;font-size:16px}
    .produto-preco{font-weight:bold;color:#27ae60;font-size:16px}
    .produto-estoque{font-size:13px;color:#7f8c8d;margin:5px 0}
    .estoque-ok{color:#27ae60}
    .estoque-baixo{color:#f39c12}
    .estoque-zero{color:#e74c3c}
    .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:1000;overflow-y:auto;padding:20px}
    .modal.show{display:flex;align-items:center;justify-content:center}
    .modal-content{background:#fff;border-radius:10px;max-width:700px;width:100%;max-height:90vh;overflow-y:auto}
    .modal-header{background:#2c3e50;color:#fff;padding:20px;border-radius:10px 10px 0 0;display:flex;justify-content:space-between;align-items:center}
    .modal-title{font-size:22px;font-weight:bold}
    .close{background:none;border:none;color:#fff;font-size:28px;cursor:pointer}
    .modal-body{padding:25px}
    .form-group{margin-bottom:15px}
    .form-group label{display:block;margin-bottom:6px;font-weight:bold;color:#2c3e50}
    .form-group input,.form-group select{width:100%;padding:10px;border:2px solid #ddd;border-radius:5px;font-size:15px}
    .form-group input:focus,.form-group select:focus{border-color:#3498db;outline:none}
    .pers-section{margin:20px 0}
    .pers-title{font-size:16px;font-weight:bold;color:#2c3e50;margin-bottom:12px;text-transform:uppercase}
    .opcao{background:#f8f9fa;border:2px solid #ddd;border-radius:6px;padding:12px;margin-bottom:8px;cursor:pointer;display:flex;align-items:center;gap:10px}
    .opcao:hover{border-color:#3498db;background:#e8f4f8}
    .opcao.selected{border-color:#3498db;background:#d4e9f7}
    .opcao input{width:18px;height:18px;cursor:pointer}
    .opcao label{flex:1;cursor:pointer;font-size:15px}
    .carrinho-item{background:#f8f9fa;padding:12px;border-radius:6px;margin-bottom:10px;border-left:3px solid #3498db}
    .carrinho-header{display:flex;justify-content:space-between;margin-bottom:5px}
    .carrinho-nome{font-weight:bold;color:#2c3e50}
    .carrinho-preco{font-weight:bold;color:#27ae60}
    .carrinho-pers{font-size:13px;color:#7f8c8d;margin-top:5px}
    .btn-remover{width:100%;padding:8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;margin-top:8px;cursor:pointer;font-weight:bold}
    .total-box{background:#e8f4f8;padding:18px;border-radius:8px;margin:20px 0;border:2px solid #3498db}
    .total-row{display:flex;justify-content:space-between;font-size:24px;font-weight:bold;color:#2c3e50}
  </style>
</head>
<body>
  <div class="header">
    <h1>üìã Recepcionista - Sistema Completo</h1>
    <div>
      <span style="margin-right:15px" id="relogio"></span>
      <button class="btn btn-danger" onclick="location.reload()">üîÑ Atualizar</button>
    </div>
  </div>
  
  <div class="tabs">
    <div class="tab active" onclick="abrirAba('pedidos')">üìã Pedidos</div>
    <div class="tab" onclick="abrirAba('novo-pedido')">‚ûï Novo Pedido</div>
    <div class="tab" onclick="abrirAba('estoque')">üì¶ Estoque</div>
  </div>
  
  <div class="container">
    <!-- ABA PEDIDOS -->
    <div id="section-pedidos" class="section active">
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">Aguardando Pagamento</div>
          <div class="stat-value" id="stat-aguardando">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pagos Hoje</div>
          <div class="stat-value" id="stat-pagos">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Pedidos</div>
          <div class="stat-value" id="stat-total">0</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-title">Lista de Pedidos</div>
        <div id="lista-pedidos"></div>
      </div>
    </div>
    
    <!-- ABA NOVO PEDIDO -->
    <div id="section-novo-pedido" class="section">
      <div class="card">
        <div class="card-title">üì¶ Estoque Dispon√≠vel</div>
        <div class="grid" id="cardapio-grid"></div>
      </div>
      
      <div class="card" id="carrinho-card" style="display:none">
        <div class="card-title">üõí Pedido Atual</div>
        <div id="carrinho-lista"></div>
        <div class="total-box">
          <div class="total-row">
            <span>Total</span>
            <span id="carrinho-total">R$ 0,00</span>
          </div>
        </div>
        <button class="btn btn-success" style="width:100%;padding:16px;font-size:18px" onclick="finalizarPedidoRecep()">‚úÖ Finalizar Pedido</button>
      </div>
    </div>
    
    <!-- ABA ESTOQUE -->
    <div id="section-estoque" class="section">
      <div class="card">
        <div class="card-title">üì¶ Estoque Completo</div>
        <div class="grid" id="estoque-grid"></div>
      </div>
    </div>
  </div>
  
  <!-- MODAL PERSONALIZA√á√ÉO -->
  <div class="modal" id="modal-pers">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="pers-nome"></div>
          <div style="color:#27ae60;font-size:18px;margin-top:5px" id="pers-preco"></div>
        </div>
        <button class="close" onclick="fecharModal('modal-pers')">&times;</button>
      </div>
      <div class="modal-body" id="pers-body"></div>
    </div>
  </div>
  
  <!-- MODAL FINALIZAR -->
  <div class="modal" id="modal-finalizar">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚úÖ Finalizar Pedido</div>
        <button class="close" onclick="fecharModal('modal-finalizar')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nome do Cliente</label>
          <input type="text" id="cliente-nome" placeholder="Digite o nome">
        </div>
        <div class="form-group">
          <label>Telefone</label>
          <input type="tel" id="cliente-tel" placeholder="(00) 00000-0000">
        </div>
        <button class="btn btn-success" style="width:100%;padding:16px;font-size:18px" onclick="salvarPedido()">üíæ Salvar Pedido</button>
      </div>
    </div>
  </div>

  <script>
    firebase.initializeApp({
      apiKey:"AIzaSyAdAQ0PZ3OlOO4i-t7gTi1LqZFnDJXn-eg",
      authDomain:"sistema-padaria-a1ee0.firebaseapp.com",
      databaseURL:"https://sistema-padaria-a1ee0-default-rtdb.firebaseio.com",
      projectId:"sistema-padaria-a1ee0",
      storageBucket:"sistema-padaria-a1ee0.firebasestorage.app",
      messagingSenderId:"1011463014195",
      appId:"1:1011463014195:web:79f941437e29f57a8aa046"
    });
    
    const db=firebase.database();
    let carrinho=[];
    let produtoAtual=null;
    let todosInsumos={};
    let todosProdutos={};
    let todosEstoque={};
    
    setInterval(()=>{
      const agora=new Date();
      document.getElementById('relogio').textContent=agora.toLocaleTimeString('pt-BR');
    },1000);
    
    window.onload=()=>{
      carregarDados();
      db.ref('pedidos').on('value',()=>carregarPedidos());
      db.ref('cardapio').on('value',snapshot=>{
        todosProdutos=snapshot.val()||{};
        renderizarCardapio();
        renderizarEstoque();
      });
      db.ref('insumos').on('value',snapshot=>{
        todosInsumos=snapshot.val()||{};
      });
      db.ref('estoque').on('value',snapshot=>{
        todosEstoque=snapshot.val()||{};
        renderizarCardapio();
        renderizarEstoque();
      });
    };
    
    function carregarDados(){
      carregarPedidos();
      renderizarCardapio();
      renderizarEstoque();
    }
    
    function abrirAba(aba){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('section-'+aba).classList.add('active');
    }
    
    function carregarPedidos(){
      db.ref('pedidos').once('value',snapshot=>{
        const pedidos=[];
        snapshot.forEach(child=>pedidos.push({...child.val(),key:child.key}));
        
        const hoje=new Date().toDateString();
        const aguardando=pedidos.filter(p=>p.status==='aguardando_pagamento').length;
        const pagos=pedidos.filter(p=>p.status!=='aguardando_pagamento'&&new Date(p.dataHora).toDateString()===hoje).length;
        
        document.getElementById('stat-aguardando').textContent=aguardando;
        document.getElementById('stat-pagos').textContent=pagos;
        document.getElementById('stat-total').textContent=pedidos.length;
        
        pedidos.sort((a,b)=>new Date(b.dataHora)-new Date(a.dataHora));
        
        const lista=document.getElementById('lista-pedidos');
        lista.innerHTML=pedidos.map(p=>`
          <div class="pedido-card">
            <div class="pedido-header">
              <div class="pedido-numero">#${p.numero}</div>
              <div class="pedido-status status-${p.status.replace('_','-')}">${p.status.replace('_',' ').toUpperCase()}</div>
            </div>
            <div class="pedido-info">
              <div class="pedido-cliente">üë§ ${p.cliente}</div>
              <div style="font-size:14px;color:#7f8c8d;margin-top:3px">üìû ${p.telefone}</div>
            </div>
            <div class="pedido-itens">
              ${p.itens.map(i=>`<div>‚Ä¢ ${i.emoji} ${i.nome} ${i.personalizacao?' - '+i.personalizacao:''}</div>`).join('')}
            </div>
            <div style="font-weight:bold;color:#27ae60;margin:10px 0">Total: R$ ${p.total.toFixed(2).replace('.',',')}</div>
            <div class="pedido-actions">
              ${p.status==='aguardando_pagamento'?`
                <button class="btn btn-success" onclick="confirmarPagamento('${p.key}')">‚úÖ Confirmar Pagamento</button>
                <button class="btn btn-warning" onclick="finalizarDireto('${p.key}')">‚ö° Finalizar Direto</button>
              `:''}
              ${p.status==='pago'?`<button class="btn btn-primary" onclick="enviarChapeiro('${p.key}')">üë®‚Äçüç≥ Enviar para Chapeiro</button>`:''}
              ${p.status==='pronto'?`<button class="btn btn-success" onclick="marcarEntregue('${p.key}')">üì¶ Marcar Entregue</button>`:''}
            </div>
          </div>
        `).join('')||'<p style="text-align:center;color:#7f8c8d;padding:40px">Nenhum pedido</p>';
      });
    }
    
    function renderizarCardapio(){
      const grid=document.getElementById('cardapio-grid');
      const cats={sanduiche:[],adicional:[],bebida:[]};
      
      for(let id in todosProdutos){
        const p={...todosProdutos[id],id};
        const est=todosEstoque[id];
        p.quantidade=est?est.quantidade:0;
        if(cats[p.categoria])cats[p.categoria].push(p);
      }
      
      let html='';
      ['sanduiche','adicional','bebida'].forEach(cat=>{
        cats[cat].forEach(p=>{
          const esgotado=p.quantidade===0;
          html+=`
            <div class="produto-card ${esgotado?'esgotado':''}" ${esgotado?'':`onclick="selecionarProduto('${p.id}')"`}>
              <div class="produto-header">
                <div class="produto-nome">${p.emoji||'üì¶'} ${p.nome}</div>
                <div class="produto-preco">R$ ${p.preco.toFixed(2).replace('.',',')}</div>
              </div>
              <div class="produto-estoque ${p.quantidade===0?'estoque-zero':p.quantidade<=5?'estoque-baixo':'estoque-ok'}">
                Estoque: ${p.quantidade} ${esgotado?'(ESGOTADO)':''}
              </div>
            </div>
          `;
        });
      });
      
      grid.innerHTML=html||'<p style="text-align:center;color:#7f8c8d">Nenhum produto</p>';
    }
    
    function renderizarEstoque(){
      const grid=document.getElementById('estoque-grid');
      let html='';
      
      for(let id in todosEstoque){
        const e=todosEstoque[id];
        const p=todosProdutos[id];
        if(!p)continue;
        
        html+=`
          <div class="produto-card">
            <div class="produto-header">
              <div class="produto-nome">${e.emoji||'üì¶'} ${e.nome}</div>
              <div class="produto-preco">R$ ${p.preco.toFixed(2).replace('.',',')}</div>
            </div>
            <div class="produto-estoque ${e.quantidade===0?'estoque-zero':e.quantidade<=5?'estoque-baixo':'estoque-ok'}">
              <strong>Estoque: ${e.quantidade}</strong>
            </div>
          </div>
        `;
      }
      
      grid.innerHTML=html||'<p style="text-align:center;color:#7f8c8d">Nenhum produto</p>';
    }
    
    function selecionarProduto(id){
      const p=todosProdutos[id];
      produtoAtual={...p,id};
      
      document.getElementById('pers-nome').textContent=`${p.emoji||'üì¶'} ${p.nome}`;
      document.getElementById('pers-preco').textContent=`R$ ${p.preco.toFixed(2).replace('.',',')}`;
      
      let html='';
      
      if(p.categoria==='sanduiche'&&Object.keys(todosInsumos).length>0){
        const queijos=[],comps=[];
        for(let iid in todosInsumos){
          const i={...todosInsumos[iid],id:iid};
          if(i.tipo==='queijo')queijos.push(i);
          else comps.push(i);
        }
        
        if(queijos.length>0){
          html+='<div class="pers-section"><div class="pers-title">Escolha o queijo:</div>';
          queijos.forEach(q=>{
            html+=`<div class="opcao" onclick="selQueijo(this)">
              <input type="radio" name="q" id="q${q.id}">
              <label for="q${q.id}">${q.nome}</label>
            </div>`;
          });
          html+='</div>';
        }
        
        if(comps.length>0){
          html+='<div class="pers-section"><div class="pers-title">Ingredientes (desmarque o que N√ÉO quer):</div>';
          comps.forEach(c=>{
            html+=`<div class="opcao selected" onclick="togComp(this)">
              <input type="checkbox" id="c${c.id}" checked>
              <label for="c${c.id}">${c.nome}</label>
            </div>`;
          });
          html+='</div>';
        }
      }
      
      html+='<button class="btn btn-success" style="width:100%;padding:16px;font-size:18px" onclick="adicionarCarrinho()">‚úÖ Adicionar ao Pedido</button>';
      
      document.getElementById('pers-body').innerHTML=html;
      document.getElementById('modal-pers').classList.add('show');
    }
    
    function selQueijo(el){
      el.parentElement.querySelectorAll('.opcao').forEach(o=>o.classList.remove('selected'));
      el.classList.add('selected');
      el.querySelector('input').checked=true;
    }
    
    function togComp(el){
      el.classList.toggle('selected');
      const i=el.querySelector('input');
      i.checked=!i.checked;
    }
    
    function adicionarCarrinho(){
      const pers=[];
      document.querySelectorAll('input:checked').forEach(inp=>{
        const lbl=document.querySelector(`label[for="${inp.id}"]`);
        if(lbl)pers.push(lbl.textContent.trim());
      });
      
      carrinho.push({
        id:Date.now(),
        produtoId:produtoAtual.id,
        nome:produtoAtual.nome,
        preco:produtoAtual.preco,
        emoji:produtoAtual.emoji,
        pers:pers.join(', ')||'Padr√£o'
      });
      
      fecharModal('modal-pers');
      atualizarCarrinho();
    }
    
    function atualizarCarrinho(){
      if(carrinho.length===0){
        document.getElementById('carrinho-card').style.display='none';
        return;
      }
      
      document.getElementById('carrinho-card').style.display='block';
      const total=carrinho.reduce((s,i)=>s+i.preco,0);
      
      document.getElementById('carrinho-lista').innerHTML=carrinho.map(i=>`
        <div class="carrinho-item">
          <div class="carrinho-header">
            <div class="carrinho-nome">${i.emoji} ${i.nome}</div>
            <div class="carrinho-preco">R$ ${i.preco.toFixed(2).replace('.',',')}</div>
          </div>
          <div class="carrinho-pers">${i.pers}</div>
          <button class="btn-remover" onclick="removerItem(${i.id})">üóëÔ∏è Remover</button>
        </div>
      `).join('');
      
      document.getElementById('carrinho-total').textContent=`R$ ${total.toFixed(2).replace('.',',')}`;
    }
    
    function removerItem(id){
      carrinho=carrinho.filter(i=>i.id!==id);
      atualizarCarrinho();
    }
    
    function finalizarPedidoRecep(){
      if(carrinho.length===0){
        alert('‚ùå Adicione produtos ao pedido');
        return;
      }
      document.getElementById('modal-finalizar').classList.add('show');
    }
    
    function salvarPedido(){
      const nome=document.getElementById('cliente-nome').value.trim();
      if(!nome){
        alert('‚ùå Digite o nome do cliente');
        return;
      }
      
      const tel=document.getElementById('cliente-tel').value.trim();
      const total=carrinho.reduce((s,i)=>s+i.preco,0);
      const num=Date.now()%100000;
      
      db.ref('pedidos/'+num).set({
        numero:num,
        cliente:nome,
        telefone:tel||'N√£o informado',
        itens:carrinho.map(i=>({
          nome:i.nome,
          preco:i.preco,
          emoji:i.emoji,
          quantidade:1,
          personalizacao:i.pers
        })),
        total:total,
        status:'aguardando_pagamento',
        dataHora:new Date().toISOString()
      }).then(()=>{
        alert('‚úÖ Pedido #'+num+' criado!');
        carrinho=[];
        atualizarCarrinho();
        fecharModal('modal-finalizar');
        document.getElementById('cliente-nome').value='';
        document.getElementById('cliente-tel').value='';
        abrirAba('pedidos');
        document.querySelectorAll('.tab')[0].classList.add('active');
      });
    }
    
    function confirmarPagamento(key){
      if(!confirm('Confirmar pagamento?'))return;
      db.ref('pedidos/'+key+'/status').set('pago').then(()=>alert('‚úÖ Pagamento confirmado!'));
    }
    
    function finalizarDireto(key){
      if(!confirm('Finalizar pedido direto (sem passar pelo chapeiro)?'))return;
      db.ref('pedidos/'+key+'/status').set('finalizado').then(()=>alert('‚úÖ Pedido finalizado!'));
    }
    
    function enviarChapeiro(key){
      if(!confirm('Enviar para o chapeiro?'))return;
      db.ref('pedidos/'+key+'/status').set('em_preparo').then(()=>alert('‚úÖ Enviado para chapeiro!'));
    }
    
    function marcarEntregue(key){
      if(!confirm('Marcar como entregue?'))return;
      db.ref('pedidos/'+key+'/status').set('finalizado').then(()=>alert('‚úÖ Pedido entregue!'));
    }
    
    function fecharModal(id){
      document.getElementById(id).classList.remove('show');
    }
  </script>
</body>
</html>
